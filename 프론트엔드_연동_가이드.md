# 프론트엔드-백엔드 연동 가이드

## 📋 사전 준비

### 1. 백엔드 실행 방법
```bash
# 프로젝트 루트 디렉토리에서 실행
./gradlew bootRun

# 또는 Windows의 경우
gradlew.bat bootRun
```

백엔드 서버가 **http://localhost:8080**에서 실행됩니다.

---

## 🔗 API Base URL

```
http://localhost:8080
```

---

## 🚀 API 엔드포인트 목록

### 1. 메시지 관리 API

#### 전체 메시지 목록 조회
```http
GET http://localhost:8080/api/messages
```

**응답 예시:**
```json
[
  {
    "id": 1,
    "senderId": 1,
    "receiverId": 2,
    "content": "안녕하세요",
    "timestamp": "2024-01-01T10:00:00",
    "isRead": false
  }
]
```

---

### 2. 시간표 관리 API

#### AI용 2D 시간표 데이터 조회
```http
GET http://localhost:8080/api/timetable/ai
Authorization: 필요 (Principal 기반)
```

**응답 예시:**
```json
[
  ["o", "x", "o", "x", "o", "x", "o", "x", "o"],
  ["x", "o", "x", "o", "x", "o", "x", "o", "x"],
  ["o", "o", "x", "x", "o", "o", "x", "x", "o"],
  ["x", "x", "o", "o", "x", "x", "o", "o", "x"],
  ["o", "x", "o", "x", "o", "x", "o", "x", "o"]
]
```
- 2D 배열: [요일][교시]
- 요일: 월(0), 화(1), 수(2), 목(3), 금(4)
- 교시: 1교시(0) ~ 9교시(8)
- 값: `"o"` = 가능, `"x"` = 불가능

---

#### 추천 시간대 조회
```http
GET http://localhost:8080/api/timetable/recommend/{otherUserId}
```

**예시:**
```http
GET http://localhost:8080/api/timetable/recommend/2
```

**응답 예시:**
```json
{
  "commonAvailableTimes": [
    { "day": "월요일", "timeSlots": ["1교시", "3교시", "5교시", "7교시"] },
    { "day": "화요일", "timeSlots": ["2교시", "4교시"] }
  ],
  "statistics": {
    "totalCommonSlots": 15,
    "recommendedSlots": [
      { "day": "월요일", "period": "1교시" },
      { "day": "화요일", "period": "2교시" }
    ]
  }
}
```

---

#### 시간표 저장/수정
```http
POST http://localhost:8080/api/timetable/save
Content-Type: application/json
```

**요청 본문:**
```json
[
  ["o", "x", "o", "x", "o", "x", "o", "x", "o"],
  ["x", "o", "x", "o", "x", "o", "x", "o", "x"],
  ["o", "o", "x", "x", "o", "o", "x", "x", "o"],
  ["x", "x", "o", "o", "x", "x", "o", "o", "x"],
  ["o", "x", "o", "x", "o", "x", "o", "x", "o"]
]
```

**응답:**
```json
"시간표가 저장되었습니다."
```

---

#### 시간표 삭제
```http
DELETE http://localhost:8080/api/timetable/delete
```

**응답:**
```json
"시간표가 삭제되었습니다."
```

---

### 3. WebSocket (실시간 채팅)

#### WebSocket 연결
```javascript
const ws = new WebSocket('ws://localhost:8080/chatserver/{username}');

// 예시
const ws = new WebSocket('ws://localhost:8080/chatserver/user1');
```

**이벤트 핸들러:**
```javascript
ws.onopen = () => {
  console.log('WebSocket 연결 성공');
};

ws.onmessage = (event) => {
  console.log('메시지 수신:', event.data);
  const message = JSON.parse(event.data);
  // 메시지 처리 로직
};

ws.onerror = (error) => {
  console.error('WebSocket 오류:', error);
};

ws.onclose = () => {
  console.log('WebSocket 연결 종료');
};

// 메시지 전송
ws.send(JSON.stringify({
  senderId: 1,
  receiverId: 2,
  content: "안녕하세요"
}));
```

---

## 💻 프론트엔드에서 API 호출 예시

### JavaScript/TypeScript (Fetch API)

```javascript
// Base URL
const API_BASE_URL = 'http://localhost:8080';

// 1. 메시지 목록 조회
async function getMessages() {
  const response = await fetch(`${API_BASE_URL}/api/messages`);
  const data = await response.json();
  console.log(data);
}

// 2. 추천 시간대 조회
async function getRecommendation(otherUserId) {
  const response = await fetch(`${API_BASE_URL}/api/timetable/recommend/${otherUserId}`);
  const data = await response.json();
  console.log(data);
}

// 3. 시간표 저장
async function saveTimetable(timetableData) {
  const response = await fetch(`${API_BASE_URL}/api/timetable/save`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(timetableData)
  });
  const result = await response.json();
  console.log(result);
}

// 4. 시간표 삭제
async function deleteTimetable() {
  const response = await fetch(`${API_BASE_URL}/api/timetable/delete`, {
    method: 'DELETE'
  });
  const result = await response.json();
  console.log(result);
}
```

### Axios 사용 예시

```javascript
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:8080',
  headers: {
    'Content-Type': 'application/json',
  },
});

// 메시지 목록 조회
api.get('/api/messages')
  .then(response => console.log(response.data))
  .catch(error => console.error(error));

// 시간표 저장
const timetableData = [
  ['o', 'x', 'o', 'x', 'o', 'x', 'o', 'x', 'o'],
  ['x', 'o', 'x', 'o', 'x', 'o', 'x', 'o', 'x'],
  // ...
];

api.post('/api/timetable/save', timetableData)
  .then(response => console.log(response.data))
  .catch(error => console.error(error));
```

---

## ⚠️ 주의사항

1. **CORS 설정**: 백엔드에서 다음 포트의 프론트엔드 요청을 허용하도록 설정되어 있습니다:
   - `http://localhost:3000` (React 기본 포트)
   - `http://localhost:5173` (Vite 기본 포트)
   - `http://localhost:5174` (Vite 대체 포트)

2. **다른 포트 사용 시**: 프론트엔드가 다른 포트에서 실행되면, 백엔드 개발자에게 알려주시면 CORS 설정을 추가할 수 있습니다.

3. **인증/인가**: 현재 일부 API는 Principal 기반 인증을 사용하므로, 프론트엔드에서 세션 쿠키를 포함해 요청해야 할 수 있습니다.

4. **CSRF**: 현재 CSRF 보호가 비활성화되어 있으므로 개발 중에는 문제없지만, 프로덕션 배포 시 활성화가 필요합니다.

---

## 🧪 테스트 방법

1. 백엔드 서버가 실행되어 있는지 확인
2. 브라우저 또는 Postman에서 API 호출 테스트
3. 프론트엔드에서 실제 연동 테스트

```bash
# 백엔드 서버 상태 확인
curl http://localhost:8080/api/messages
```

---

## 📞 문의

백엔드 개발자에게 연락주시면 추가 설정이 필요할 수 있습니다.

